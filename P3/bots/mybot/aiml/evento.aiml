<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">
	<!-- File: evento.aiml -->
	<!-- Author: Rafa -->
	<!-- Last modified: May 17, 2017  -->

<!--                      AÑADIR CONTACTO                       -->
<category>
  <pattern>^ nuevo evento ^</pattern>
  <template><srai>AÑADIR EVENTO</srai></template>
</category>

<category>
  <pattern>AÑADIR EVENTO</pattern>
  <template>Dime el nombre del evento</template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME EL NOMBRE DEL EVENTO</that>
  <template>
    <think><set name="nombre_evento"><star/></set></think>
    Dime la fecha del evento
  </template>
</category>


<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think><set name="fecha_evento"><star index="2"/>/<star index="3"/>/<star index="4"/></set></think>
    <think><set var="fecha_valida"><srai>VALIDDATE <star index="2"/> <star index="3"/> <star index="4"/></srai></set></think>
    <condition var="fecha_valida">
      <li value="YES">
        Dime la hora del evento
      </li>
      <li>La fecha introducida no es valida</li>
    </condition>
  </template>
</category>

<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos_letra</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think><set name="fecha_evento"><star index="2"/>/<map name="mes_numero"><star index="3"/></map>/<star index="4"/></set></think>
    <think><set var="fecha_valida"><srai>VALIDDATE <star index="2"/> <map name="mes_numero"><star index="3"/></map> <star index="4"/></srai></set></think>
    <condition var="fecha_valida">
      <li value="YES">
        Dime la hora del evento
      </li>
      <li>La fecha introducida no es valida</li>
    </condition>
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think>
      <set var="dia"><srai>SELECTITEM 1 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="mes"><srai>SELECTITEM 2 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="anio"><srai>SELECTITEM 3 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="dia_valido"><srai>FINDITEM <get var="dia"/> IN <readset>dias_validos</readset></srai></set>
      <set var="mes_valido"><srai>FINDITEM <get var="mes"/> IN <readset>meses_validos</readset></srai></set>
      <set var="anio_valido"><srai>FINDITEM <get var="anio"/> IN <readset>años_validos</readset></srai></set>
      <set var="fecha_valida"><srai>VALIDDATE <get var="dia"/> <get var="mes"/> <get var="anio"/></srai></set>
      <set var="validez">1</set>
    </think>
    <condition var="dia_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="mes_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="anio_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="fecha_valida">
      <li value="YES"></li>
      <li><think><set var="validez">0</set></think></li>
    </condition>
    <condition var="validez">
      <li value="0">La fecha indicada no es valida</li>
      <li>
        <think><set name="fecha_evento"><get var="dia"/>/<get var="mes"/>/<get var="anio"/></set></think>
        Dime la hora del evento
      </li>
    </condition>
  </template>
</category>

<category>
  <pattern>^ <set>horas_validas</set> ^</pattern>
  <that>DIME LA HORA DEL EVENTO</that>
  <template>
    <think>
      <set name="hora_evento"><star index="2"/></set>
      <set var="pos_hora"><map name="hora_posicion"><srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></map></set>
      <set var="pos_fecha_evento"><srai>FINDITEM <get name="fecha_evento"/> IN <readkeys>eventos</readkeys></srai></set>
    </think>
    <condition var="pos_fecha_evento">
    <li value="0">
      <addtomap>
        <name>eventos</name>
        <key><get name="fecha_evento"/></key>
        <value><srai>CHANGEITEM <get var="pos_hora"/> BY <srai>ponerbarrabaja <get name="nombre_evento"/></srai> IN null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null</srai></value>
      </addtomap>
      Quiere asociar algun contacto al evento?
    </li>
    <li>
      <think><set var="evento_anterior"><srai>SELECTITEM <get var="pos_hora"/> IN <map name="eventos"><get name="fecha_evento"/></map></srai></set></think>
      <condition var="evento_anterior">
        <li value="null">
          <modifymap>
            <name>eventos</name>
            <key><get name="fecha_evento"/></key>
            <value><srai>CHANGEITEM <get var="pos_hora"/> BY <srai>ponerbarrabaja <get name="nombre_evento"/></srai> IN <map name="eventos"><get name="fecha_evento"/></map></srai></value>
          </modifymap>
          Quiere asociar algun contacto al evento?
        </li>
        <li>Ya existe un evento en esa fecha a esa hora</li>
      </condition>
    </li>
    </condition>
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA HORA DEL EVENTO</that>
  <template>
    La hora indicada no es valida. Recuerde que los eventos comienzan a las en punto y a las y media. El formato de la hora es hh:mm donde hh esta en formato 24 horas
  </template>
</category>

<category>
  <pattern>^ si ^</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>Dime el apellido del contacto que desea asociar al evento</template>
</category>

<category>
  <pattern>^ no ^</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>Perfecto. Evento <get name="nombre_evento"/> añadido el <get name="fecha_evento"/> a las <get name="hora_evento"/></template>
</category>

<category>
  <pattern>*</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>No le he entendido, quiere asociar algun contacto al evento?</template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME EL APELLIDO DEL CONTACTO QUE DESEA ASOCIAR AL EVENTO</that>
  <template>
    <think><set var="pos"><srai>FINDITEM <srai>ponerbarrabaja <star/></srai> IN <readset>contactos</readset> º</srai></set></think>
    <condition var="pos">
      <li value="0">
        El contacto que quiere asociar no se encuentra en su agenda, quiere asociar otro contacto al evento?
      </li>
      <li>
        <think><set var="pos_temp"><srai>FINDITEM <get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai> IN <readkeys>evper</readkeys></srai></set></think>
        <condition var="pos_temp">
          <li value="0">
            <addtomap>
              <name>evper</name>
              <key><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></key>
              <value><srai>ponerbarrabaja <star/></srai></value>
            </addtomap>
          </li>
          <li>
            <modifymap>
              <name>evper</name>
              <key><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></key>
              <value><map name="evper"><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></map> <srai>ponerbarrabaja <star/></srai></value>
            </modifymap>
          </li>
        </condition>
        Contacto agregado, quiere asociar otro contacto al evento?
      </li>
    </condition>
  </template>
</category>




<!--                        PLANTILLA                            -->
<category>
  <pattern></pattern>
  <template></template>
</category>


</aiml>
