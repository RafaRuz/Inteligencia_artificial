<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">
	<!-- File: evento.aiml -->
	<!-- Author: Rafa -->
	<!-- Last modified: May 17, 2017  -->

<!--                      AÑADIR CONTACTO                       -->
<category>
  <pattern>^ nuevo evento ^</pattern>
  <template><srai>AÑADIR EVENTO</srai></template>
</category>

<category>
  <pattern>AÑADIR EVENTO</pattern>
  <template>Dime el nombre del evento</template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME EL NOMBRE DEL EVENTO</that>
  <template>
    <think><set name="nombre_evento"><star/></set></think>
    Dime la fecha del evento
  </template>
</category>


<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think><set name="fecha_evento"><star index="2"/>/<star index="3"/>/<star index="4"/></set></think>
    <think><set var="fecha_valida"><srai>VALIDDATE <star index="2"/> <star index="3"/> <star index="4"/></srai></set></think>
    <condition var="fecha_valida">
      <li value="YES">
        Dime la hora del evento
      </li>
      <li>La fecha introducida no es valida</li>
    </condition>
  </template>
</category>

<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos_letra</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think><set name="fecha_evento"><star index="2"/>/<map name="mes_numero"><star index="3"/></map>/<star index="4"/></set></think>
    <think><set var="fecha_valida"><srai>VALIDDATE <star index="2"/> <map name="mes_numero"><star index="3"/></map> <star index="4"/></srai></set></think>
    <condition var="fecha_valida">
      <li value="YES">
        Dime la hora del evento
      </li>
      <li>La fecha introducida no es valida</li>
    </condition>
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA FECHA DEL EVENTO</that>
  <template>
    <think>
      <set var="dia"><srai>SELECTITEM 1 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="mes"><srai>SELECTITEM 2 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="anio"><srai>SELECTITEM 3 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="dia_valido"><srai>FINDITEM <get var="dia"/> IN <readset>dias_validos</readset></srai></set>
      <set var="mes_valido"><srai>FINDITEM <get var="mes"/> IN <readset>meses_validos</readset></srai></set>
      <set var="anio_valido"><srai>FINDITEM <get var="anio"/> IN <readset>años_validos</readset></srai></set>
      <set var="fecha_valida"><srai>VALIDDATE <get var="dia"/> <get var="mes"/> <get var="anio"/></srai></set>
      <set var="validez">1</set>
    </think>
    <condition var="dia_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="mes_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="anio_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="fecha_valida">
      <li value="YES"></li>
      <li><think><set var="validez">0</set></think></li>
    </condition>
    <condition var="validez">
      <li value="0">La fecha indicada no es valida</li>
      <li>
        <think><set name="fecha_evento"><get var="dia"/>/<get var="mes"/>/<get var="anio"/></set></think>
        Dime la hora del evento
      </li>
    </condition>
  </template>
</category>

<category>
  <pattern>^ <set>horas_validas</set> ^</pattern>
  <that>DIME LA HORA DEL EVENTO</that>
  <template>
    <think>
      <set name="hora_evento"><star index="2"/></set>
      <set var="pos_hora"><map name="hora_posicion"><srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></map></set>
      <set var="pos_fecha_evento"><srai>FINDITEM <get name="fecha_evento"/> IN <readkeys>eventos</readkeys></srai></set>
    </think>
    <condition var="pos_fecha_evento">
    <li value="0">
      <addtomap>
        <name>eventos</name>
        <key><get name="fecha_evento"/></key>
        <value><srai>CHANGEITEM <get var="pos_hora"/> BY <srai>ponerbarrabaja <get name="nombre_evento"/></srai> IN null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null</srai></value>
      </addtomap>
      Quiere asociar algun contacto al evento?
    </li>
    <li>
      <think><set var="evento_anterior"><srai>SELECTITEM <get var="pos_hora"/> IN <map name="eventos"><get name="fecha_evento"/></map></srai></set></think>
      <condition var="evento_anterior">
        <li value="null">
          <modifymap>
            <name>eventos</name>
            <key><get name="fecha_evento"/></key>
            <value><srai>CHANGEITEM <get var="pos_hora"/> BY <srai>ponerbarrabaja <get name="nombre_evento"/></srai> IN <map name="eventos"><get name="fecha_evento"/></map></srai></value>
          </modifymap>
          Quiere asociar algun contacto al evento?
        </li>
        <li>Ya existe un evento en esa fecha a esa hora</li>
      </condition>
    </li>
    </condition>
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA HORA DEL EVENTO</that>
  <template>
    La hora indicada no es valida. Recuerde que los eventos comienzan a las en punto y a las y media. El formato de la hora es hh:mm donde hh esta en formato 24 horas
  </template>
</category>

<category>
  <pattern>^ si ^</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>Dime el apellido del contacto que desea asociar al evento</template>
</category>

<category>
  <pattern>^ no ^</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>Perfecto. Evento <get name="nombre_evento"/> añadido el <get name="fecha_evento"/> a las <get name="hora_evento"/></template>
</category>

<category>
  <pattern>*</pattern>
  <that>^ QUIERE ASOCIAR * CONTACTO AL EVENTO</that>
  <template>No le he entendido, quiere asociar algun contacto al evento?</template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME EL APELLIDO DEL CONTACTO QUE DESEA ASOCIAR AL EVENTO</that>
  <template>
    <think><set var="pos"><srai>FINDITEM <srai>ponerbarrabaja <star/></srai> IN <readset>contactos</readset> º</srai></set></think>
    <condition var="pos">
      <li value="0">
        El contacto que quiere asociar no se encuentra en su agenda, quiere asociar otro contacto al evento?
      </li>
      <li>
        <think><set var="pos_temp"><srai>FINDITEM <get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai> IN <readkeys>evper</readkeys></srai></set></think>
        <condition var="pos_temp">
          <li value="0">
            <addtomap>
              <name>evper</name>
              <key><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></key>
              <value><srai>ponerbarrabaja <star/></srai></value>
            </addtomap>
          </li>
          <li>
            <think><set var="pos_contacto"><srai>FINDITEM <srai>ponerbarrabaja <star/></srai> IN <map name="evper"><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></map></srai></set></think>
            <condition var="pos_contacto">
              <li value="0">
                <modifymap>
                  <name>evper</name>
                  <key><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></key>
                  <value><map name="evper"><get name="fecha_evento"/>_<srai>QUITARDOSPUNTOS <get name="hora_evento"/></srai></map> <srai>ponerbarrabaja <star/></srai></value>
                </modifymap>
                Contacto agregado, quiere asociar otro contacto al evento?
              </li>
              <li>El contacto que intenta añadir ya va a asistir al evento. Quiere asociar otro contacto al evento?</li>
            </condition>
          </li>
        </condition>
      </li>
    </condition>
  </template>
</category>





<!--                         CANTIDAD DE EVENTOS                         -->
<category>
  <pattern>^ [cuantos cantidad] ^ eventos ^ en total ^</pattern>
  <template>Tienes un total de <srai>CANTIDAD EVENTOS TOTAL</srai> eventos en la agenda</template>
</category>

<category>
  <pattern>^ [cuantos cantidad] ^ eventos ^ en la agenda ^</pattern>
  <template>Tienes un total de <srai>CANTIDAD EVENTOS TOTAL</srai> eventos en la agenda</template>
</category>

<category>
  <pattern>CANTIDAD EVENTOS TOTAL</pattern>
  <template>
    <think>
      <set var="lista_fechas"><readkeys>eventos</readkeys></set>
      <set var="fecha"><srai>TOP <get var="lista_fechas"/></srai></set>
      <set var="lista_fechas"><srai>REMAIN <get var="lista_fechas"/></srai></set>
      <set var="num_eventos">0</set>
    </think>
    <condition var="fecha">
      <li value="$"><get var="num_eventos"/></li>
      <li>
        <think><set var="num_eventos_fecha"><srai>CANTIDADEVENTOS <get var="fecha"/></srai></set></think>
        <condition var="num_eventos_fecha">
          <li value="0"></li>
          <li>
            <think>
              <set var="num_eventos_fecha"><map name="predecessor"><get var="num_eventos_fecha"/></map></set>
              <set var="num_eventos"><map name="successor"><get var="num_eventos"/></map></set>
            </think>
            <loop/>
          </li>
        </condition>
        <think>
          <set var="fecha"><srai>TOP <get var="lista_fechas"/></srai></set>
          <set var="lista_fechas"><srai>REMAIN <get var="lista_fechas"/></srai></set>
        </think>
        <loop/>
      </li>
    </condition>
  </template>
</category>





<!--                         MODIFICAR EVENTO                            -->
<category>
  <pattern>^ [modificar modificarme cambiar cambiarme] ^ evento ^</pattern>
  <template>Dime la fecha del evento a modificar</template>
</category>

<!--
<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO A MODIFICAR</that>
  <template>
    <think><set name="fecha_evento_modificar"><star index="2"/>/<star index="3"/>/<star index="4"/></set>
    Dime la hora del evento a modificar
  </template>
</category>
-->
<category>
  <pattern>^ <set>dias_validos</set> ([de del]) <set>meses_validos_letra</set> ([de del]) <set>años_validos</set> ^</pattern>
  <that>DIME LA FECHA DEL EVENTO A MODIFICAR</that>
  <template>
  <think><set name="fecha_evento_modificar"><star index="2"/>/<map name="mes_numero"><star index="3"/></map>/<star index="4"/></set></think>
  Dime la hora del evento a modificar
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA FECHA DEL EVENTO A MODIFICAR</that>
  <template>
    <think>
      <set var="dia"><srai>SELECTITEM 1 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="mes"><srai>SELECTITEM 2 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="anio"><srai>SELECTITEM 3 IN <srai>BARRASAESPACIOS <star/></srai></srai></set>
      <set var="dia_valido"><srai>FINDITEM <get var="dia"/> IN <readset>dias_validos</readset></srai></set>
      <set var="mes_valido"><srai>FINDITEM <get var="mes"/> IN <readset>meses_validos</readset></srai></set>
      <set var="anio_valido"><srai>FINDITEM <get var="anio"/> IN <readset>años_validos</readset></srai></set>
      <set var="fecha_valida"><srai>VALIDDATE <get var="dia"/> <get var="mes"/> <get var="anio"/></srai></set>
      <set var="validez">1</set>
    </think>
    <condition var="dia_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="mes_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="anio_valido">
      <li value="0"><think><set var="validez">0</set></think></li>
      <li></li>
    </condition>
    <condition var="fecha_valida">
      <li value="YES"></li>
      <li><think><set var="validez">0</set></think></li>
    </condition>
    <condition var="validez">
      <li value="0">La fecha indicada no es valida</li>
      <li>
        <think><set name="fecha_evento_modificar"><get var="dia"/>/<get var="mes"/>/<get var="anio"/></set></think>
        Dime la hora del evento a modificar
      </li>
    </condition>
  </template>
</category>

<category>
  <pattern>^ <set>horas_validas</set> ^</pattern>
  <that>DIME LA HORA DEL EVENTO A MODIFICAR</that>
  <template>
    <think><set name="hora_evento_modificar"><star index="2"/></set></think>
    Desea modificar el titulo, la hora o un contacto asociado?
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA HORA DEL EVENTO A MODIFICAR</that>
  <template>
    La hora indicada no es valida. Recuerde que los eventos comienzan a las en punto y a las y media. El formato de la hora es hh:mm donde hh esta en formato 24 horas
  </template>
</category>


<category>
  <pattern>^ titulo ^</pattern>
  <that>^ DESEA MODIFICAR EL TITULO, LA HORA O UN CONTACTO ASOCIADO</that>
  <template>
    Dime el nuevo titulo del evento
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME EL NUEVO TITULO DEL EVENTO</that>
  <template>
    <modifymap>
      <name>eventos</name>
      <key><get name="fecha_evento_modificar"/></key>
      <value><srai>CHANGEITEM <map name="hora_posicion"><srai>QUITARDOSPUNTOS <get name="hora_evento_modificar"/></srai></map> BY <srai>ponerbarrabaja <star/></srai> IN <map name="eventos"><get name="fecha_evento_modificar"/></map></srai></value>
    </modifymap>
    Titulo del evento el dia <get name="fecha_evento_modificar"/> a las <get name="hora_evento_modificar"/> modificado por: <star/>
  </template>
</category>

<category>
  <pattern>^ hora ^</pattern>
  <that>^ DESEA MODIFICAR EL TITULO, LA HORA O UN CONTACTO ASOCIADO</that>
  <template>Dime la nueva hora del evento</template>
</category>

<category>
  <pattern>^ <set>horas_validas</set> ^</pattern>
  <that>DIME LA NUEVA HORA DEL EVENTO</that>
  <template>
    <think><set name="hora_evento_modificar"><star index="2"/></set></think>
    Desea modificar el titulo, la hora o un contacto asociado?
  </template>
</category>

<category>
  <pattern>*</pattern>
  <that>DIME LA NUEVA HORA DEL EVENTO</that>
  <template>
    La hora indicada no es valida. Recuerde que los eventos comienzan a las en punto y a las y media. El formato de la hora es hh:mm donde hh esta en formato 24 horas
  </template>
</category>

<category>
  <pattern>^ contacto ^</pattern>
  <that>^ DESEA MODIFICAR EL TITULO, LA HORA O UN CONTACTO ASOCIADO</that>
  <template></template>
</category>

<category>
  <pattern>*</pattern>
  <that>^ DESEA MODIFICAR EL TITULO, LA HORA O UN CONTACTO ASOCIADO</that>
  <template>No le he entendido, desea modificar el titulo, la hora o un contacto asociado?</template>
</category>

<category>
  <pattern>^ nada ^</pattern>
  <that>^ DESEA MODIFICAR EL TITULO, LA HORA O UN CONTACTO ASOCIADO</that>
  <template>De acuerdo, no modifico nada</template>
</category>







<!--                            BORRAR EVENTO                            -->





<!--                      EVENTOS EN UN DIA CONCRETO                  -->
<category>
  <pattern>^ [lista listame listar que] ^ eventos ^ el (dia) *</pattern>
  <template>Tienes los siguientes eventos: <srai>EVENTOS <star index="4"/></srai></template>
</category>

<category>
  <pattern>^ [lista listame listar que] ^ eventos ^ el (dia) <set>dias_validos</set> (de) <set>meses_validos_letra</set> ([de del]) <set>años_validos</set> ^</pattern>
  <template>Tienes los siguientes eventos: <srai>EVENTOS <star index="4"/>/<map name="mes_numero"><star index="5"/></map>/<star index="6"/></srai></template>
</category>

<category>
  <pattern>^ [lista listame listar que] ^ eventos ^ el (dia) <set>dias_validos</set> (de) <set>meses_validos</set> ([de del]) <set>años_validos</set> ^</pattern>
  <template>Tienes los siguientes eventos: <srai>EVENTOS <star index="4"/>/<star index="5"/>/<star index="6"/></srai></template>
</category>

<category>
  <pattern>EVENTOS *</pattern>
  <template>
    <think><set var="eventos"><map name="eventos"><star/></map></set></think>
    <condition var="eventos">
      <li value="unknown"></li>
      <li>
        <think>
          <set var="palabra"><srai>TOP <get var="eventos"/></srai></set>
          <set var="eventos"><srai>REMAIN <get var="eventos"/></srai></set>
          <set var="sol"></set>
        </think>
        <condition var="palabra">
          <li value="null">
            <think>
              <set var="palabra"><srai>TOP <get var="eventos"/></srai></set>
              <set var="eventos"><srai>REMAIN <get var="eventos"/></srai></set>
            </think>
            <loop/>
          </li>
          <li value="$"><get var="sol"/></li>
          <li>
            <think>
              <set var="sol"><get var="sol"/> <get var="palabra"/></set>
              <set var="palabra"><srai>TOP <get var="eventos"/></srai></set>
              <set var="eventos"><srai>REMAIN <get var="eventos"/></srai></set>
            </think>
            <loop/>
          </li>
        </condition>
      </li>
    </condition>
  </template>
</category>





<!--           CANTIDAD EVENTOS EN UNA FECHA PARTICULAR                  -->
<category>
  <pattern>^ [cantidad cuantos] ^ eventos ^ el (dia) *</pattern>
  <template>Tienes <srai>CANTIDADEVENTOS <star index="4"/></srai> eventos</template>
</category>

<category>
  <pattern>^ [cantidad cuantos] ^ eventos ^ el (dia) <set>dias_validos</set> (de) <set>meses_validos_letra</set> ([de del]) <set>años_validos</set> ^</pattern>
  <template>Tienes <srai>CANTIDADEVENTOS <star index="4"/>/<map name="mes_numero"><star index="5"/></map>/<star index="6"/></srai> eventos</template>
</category>

<category>
  <pattern>^ [cantidad cuantos] ^ eventos ^ el (dia) <set>dias_validos</set> (de) <set>meses_validos</set> ([de del]) <set>años_validos</set> ^</pattern>
  <template>Tienes <srai>CANTIDADEVENTOS <star index="4"/>/<star index="5"/>/<star index="6"/></srai> eventos</template>
</category>

<category>
  <pattern>CANTIDADEVENTOS *</pattern>
  <template>
    <srai>COUNT <srai>EVENTOS <star/></srai></srai>
  </template>
</category>











<!--                              PLANTILLA                              -->
<category>
  <pattern></pattern>
  <template></template>
</category>


</aiml>
